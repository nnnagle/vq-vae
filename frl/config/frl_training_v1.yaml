# ================================================================
# Forest Representation Learning - Training Configuration v0
# ================================================================
version: "1.0"
name: forest_trajectory_v0

config:
  bindings_path: config/frl_bindings_v0.yaml
  model_path: config/frl_model_v0.yaml
  
run:
  experiment_name: frl_v0_exp003
  run_root: runs
  ckpt_dir: checkpoints
  log_dir: logs
  
  checkpoint:
    save_every_n_epochs: 5
    save_top_k: 3
    monitor: val/loss_total
    mode: min
    save_last: true
    
hardware:
  device: cuda
  gpu_ids: [0]
  num_workers: 4
  pin_memory: true
  
  mixed_precision:
    enabled: true
    dtype: bfloat16
    
training:
  epoch:
    num_epochs: 100
    mode: full # full/frac/number - use every batch or take a sample
    sample_frac: .1
    sample_number: 1000
    batch_size: 4
  
  gradient_clip:
    enabled: true
    max_norm: 1.0
    
  early_stopping:
    enabled: true
    patience: 15
    
  validation:
    enabled: true
    val_every_n_epochs: 1
    val_fraction: 0.15
    
optimizer:
  name: adamw
  lr: 1.0e-4
  weight_decay: 0.01
        
scheduler:
  name: cosine_warmup
  warmup:
    enabled: true
    epochs: 5
  T_max: 95
  eta_min: 1.0e-6
    
spatial_domain:
  debug_mode: true
  debug_window:
    origin: [0, 0] #[row, col]
    size: [1024, 1024] # [H,W]
    block_grid: [1,1]
  full_domain:
    origin: [0, 0] # row, col
    size: [13056, 23552] # Height, Width
    block_grid: [7, 7] # The val/train/test split using a block size of [y,x] patches
    
sampling:
  patch_size: 256
  grid_subsample:
    enabled: false
    grid_size: [16, 16]
  forest_samples:
    enabled: false
    per_patch: 64

masking:
  global_mask: [shared.masks.aoi, shared.masks.forest]
  per_loss_masks:
    z_type_triplet: [shared.masks.aoi, shared.masks.forest]
  global_weight: shared.quality.forest_weight
    
metrics:
  train: [loss_total, loss_vq, loss_triplet, learning_rate]
  validation: [loss_total, loss_vq]
  latent_analysis:
    enabled: true
    compute_every_n_epochs: 10
      
visualization:
  enabled: false
  tensorboard:
    log_images_every_n_epochs: 5
    
reproducibility:
  seed: 42
  benchmark: true